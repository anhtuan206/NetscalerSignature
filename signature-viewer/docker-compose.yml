services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile

    restart: unless-stopped
    networks:
      - public-mendix-app
    depends_on:
      - backend
    labels:
      # Autoheal
      autoheal: true
      # Enable Traefik
      traefik.enable: true
      # HTTPS Router
      traefik.http.routers.sigedit.rule: Host(`sigedit.cpc.vn`)
      traefik.http.routers.sigedit.entrypoints: websecure
      traefik.http.routers.sigedit.tls: true
      traefik.http.routers.sigedit.tls.certresolver: myresolver
      traefik.http.routers.sigedit.priority: 10
      traefik.http.services.sigedit.loadbalancer.server.port: "80"
      # HTTP Router â†’ redirect to HTTPS
      traefik.http.routers.sigedit-http.rule: Host(`sigedit.cpc.vn`)
      traefik.http.routers.sigedit-http.entrypoints: web
      traefik.http.routers.sigedit-http.middlewares: redirect-to-https
      traefik.http.routers.sigedit-http.priority: 1

      # Middleware for redirect
      traefik.http.middlewares.redirect-to-https.redirectscheme.scheme: https

  backend:
    build:
      context: .
      dockerfile: Dockerfile.server

    restart: unless-stopped
    networks:
      - public-mendix-app
    volumes:
      - vol_sigedit:/app/uploads

volumes:
  vol_sigedit:


networks:
  public-mendix-app:
    external: true
