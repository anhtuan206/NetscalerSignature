services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile

    restart: unless-stopped
    networks:
      - public-mendix-app
    depends_on:
      - backend
    labels:
      # Autoheal
      autoheal: true
      # Enable Traefik
      traefik.enable: true
      # HTTPS Router
      traefik.http.routers.sigeditor.rule: Host(`sigeditor.cpc.vn`)
      traefik.http.routers.sigeditor.entrypoints: websecure
      traefik.http.routers.sigeditor.tls: true
      traefik.http.routers.sigeditor.tls.certresolver: myresolver
      traefik.http.routers.sigeditor.priority: 10
      traefik.http.services.sigeditor.loadbalancer.server.port: "80"
      # HTTP Router â†’ redirect to HTTPS
      traefik.http.routers.sigeditor-http.rule: Host(`sigeditor.cpc.vn`)
      traefik.http.routers.sigeditor-http.entrypoints: web
      traefik.http.routers.sigeditor-http.middlewares: redirect-to-https
      traefik.http.routers.sigeditor-http.priority: 1

      # Middleware for redirect
      traefik.http.middlewares.redirect-to-https.redirectscheme.scheme: https

  backend:
    build:
      context: .
      dockerfile: Dockerfile.server

    restart: unless-stopped
    networks:
      - public-mendix-app
    volumes:
      - vol_sigeditor:/app/uploads

volumes:
  vol_sigeditor:


networks:
  public-mendix-app:
    external: true
